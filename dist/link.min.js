!function(t,e,n){"use strict";"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&(define.amd||define.cmd)?define(n):t[e]=n()}(window||this,"link",function(){"use strict";function Node(t,e,n,i){this.id=t,this.path=e,this.pid=n,this.config=i}function Tree(){this.nodeList=[],this.levelBox=[]}function Link(t){t=util.extend({cache:!1},t),this.init(t)}function init(){var t=new Link;t.version=VERSION,t.destroy=destroy,t.listen=t.on=event.listen,t.remove=t.off=event.remove,t.trigger=t.emit=event.trigger;var e=new Tree;return t.startRecording=function(){e.start()},t.endRecording=function(){e.end()},t}function destroy(t){t.destroy()}var VERSION="1.0.0",STATUS={VISIBLE:"visible",HIDDEN:"hidden",TOGGLE:"toggle"},LINK_PREFIX_DATA="data",LINK_PREFIX_LINK="link",LINK_ATTR_HREF="href",LINK_ATTR_TEMPLATE="tpl",LINK_ATTR_CONTAINER="container",LINK_ATTR_STATUS="status",LINK_ATTR_ANIMATE="animate",LINK_ATTR_ACTION="action",LINK_ATTR_GROUP="group",EVENTS={ANIMATE:"link.animate"},EMPTY_FN=function(){},event=function(){var t,e,n,i={};return t=function(t,e,n){for(var r=t.split(/[\,\s\;]/),o=r.length;o;){o--;var a=r[o];i[a]||(i[a]=[]),i[a].push({fn:e,data:n})}},n=function(t,e){if(i[t])if(e)for(var n=0,r=i[t].length;n<r;n++)i[t][n].fn===e&&i[t].splice(n,1);else i[t]=[]},e=function(t,e){for(var n,r=t,o=t.split("."),a=0,s=o.length;a<s;a++){if(n=i[r])for(var c=0,u=n.length;c<u;)n[c].fn(e),c++;o.pop(),r=o.join(".")}},{listen:t,remove:n,trigger:e}}(),RADIX=1e6;Node.prototype.setId=function(t){return this.id=t,this},Node.prototype.setPid=function(t){return this.pid=t,this},Tree.prototype.insert=function(t,e){t=t.replace(/\/*$/,"");var n=new Node(null,t,null,e),i=this.generateId(n);return this.nodeList[i]=n.setId(i),this},Tree.prototype.generateId=function(t){var e=t.path.split("/").length;this.levelBox[e]||(this.levelBox[e]={maxId:e*RADIX,items:[]});var n=this.levelBox[e].maxId+1;return this.levelBox[e].maxId=n,n},Tree.prototype.resolveParent=function(){var t=this.nodeList.concat(),e=[];t.forEach(function(t){for(var n=e.length-1;n>=0;n--){var i=e[n];if(0===t.path.indexOf(i.path)){t.setPid(i.id);break}}e.push(t)})},Tree.prototype.collect=function(t){var e=view.searchUp(t.target,LINK_PREFIX_LINK);if(e){var n=view.resolveLink(e);this.insert(view.attr(e,LINK_ATTR_HREF),n)}},Tree.prototype.print=function(){var t=this.nodeList.concat(),e={};t.forEach(function(t){e[t.path]=t.config}),console.log(e)},Tree.prototype.start=function(){var t=this;document.addEventListener("click",function(e){t.collect(e)},!1)},Tree.prototype.end=function(){this.resolveParent(),this.print()};var cache={count:0,set:function(t,e){cache[location.pathname+t]=e},get:function(t){return cache[location.pathname+t]}},util={extend:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},isEmpty:function(t){return null===t||void 0===t},isSelector:function(t){return/^[#.][0-9a-zA-z_-]+/.test(t)},isFilePath:function(t){return/\.[0-9a-zA-z]+$/.test(t)}},view={searchUp:function t(e,n){if(e!==document.body&&e!==document)return e.hasAttribute(n)?e:t(e.parentNode,n)},getHtmlContent:function(t,e){if(!t)return e("");if(util.isSelector(t))return e(this.html(document.querySelector(t)));if(!util.isFilePath(t))return e(t);var n=cache.get(t);if(n)return e(n);var i=new XMLHttpRequest;i.onreadystatechange=function(r){if(4==i.readyState)return i.status>=200&&i.status<300||304==i.status?(n=i.responseText,cache.set(t,n),e(n)):(console.error("Request was unsuccessful: "+i.status),e())},i.open("get",t,!0),i.send(null)},resolveLink:function(t){return{template:view.attr(t,LINK_ATTR_TEMPLATE),container:view.attr(t,LINK_ATTR_CONTAINER),status:view.attr(t,LINK_ATTR_STATUS)||STATUS.VISIBLE,animate:view.attr(t,LINK_ATTR_ANIMATE),action:view.attr(t,LINK_ATTR_ACTION)||EMPTY_FN,group:view.attr(t,LINK_ATTR_GROUP)}},status:function(t,e){if(e&&STATUS[e.toUpperCase()]){var n=STATUS[e.toUpperCase()];n===STATUS.TOGGLE&&(n=t.style.visibility===STATUS.VISIBLE?STATUS.HIDDEN:STATUS.VISIBLE),t.style.visibility=n}},animate:function(t,e,n){event.trigger(EVENTS.ANIMATE,{targetNode:t,animate:e,content:n})},group:function(t,e,n){if(util.isEmpty(n))return!1;for(var i=this.hitAttr(e,LINK_ATTR_GROUP),r=document.querySelectorAll("["+i+"='"+n+"']"),o=0,a=r.length;o<a;o++)document.querySelector(this.attr(r[o],LINK_ATTR_CONTAINER)).style.display="none";t.style.display="block"},hitAttr:function(t,e){for(var n=t.attributes,i=0,r=n.length;i<r;i++){var o=n[i].name,a=new RegExp("("+LINK_PREFIX_DATA+"-)?("+LINK_PREFIX_LINK+"-)?(.*)");if(e===o.replace(a,"$3"))return o}},attr:function(t,e){var n=this.hitAttr(t,e);return t.getAttribute(n)},html:function(t,e){return void 0===e?t.innerHTML:void(t.innerHTML=e)}},handleEvent={init:function(){this.unbind(),this.bind()},unbind:function(){document.removeEventListener("click",this.click,!1)},bind:function(){document.addEventListener("click",this.click,!1)},click:function(event){var node=view.searchUp(event.target,LINK_PREFIX_LINK);if(node){var linkDom=view.resolveLink(node);view.getHtmlContent(linkDom.template,function(content){for(var targetNodes=document.querySelectorAll(linkDom.container),targetNode="",i=0,len=targetNodes.length;i<len;i++)targetNode=targetNodes[i],null!==linkDom.animate?view.animate(targetNode,linkDom.animate,content):view.html(targetNode,content),view.status(targetNode,linkDom.status),view.group(targetNode,node,linkDom.group),eval("("+linkDom.action+")")(targetNode)})}}};return Link.prototype={init:function(t){handleEvent.init()},destroy:function(){cache={count:0}}},Object.defineProperty(Link.prototype,"constructor",{enumerable:!1,value:Link}),init()});